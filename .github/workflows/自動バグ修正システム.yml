name: ğŸ› AIè‡ªå‹•ãƒã‚°ä¿®æ­£ã‚·ã‚¹ãƒ†ãƒ 
on:
  issues:
    types: [opened, labeled]
  issue_comment:
    types: [created]

jobs:
  auto-fix-bug:
    if: contains(github.event.issue.labels.*.name, 'bug')
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ¤– AI Bug Fixer
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.ANTHROPIC_API_KEY }}
          trigger_phrase: "@claude-fix"
          branch_prefix: "fix/"

          mcp_config: |
            {
              "mcpServers": {
                "serena": {
                  "command": "uvx",
                  "args": [
                    "--from", "git+https://github.com/oraios/serena",
                    "serena-mcp-server"
                  ]
                },
                "claude-flow": {
                  "command": "npx",
                  "args": ["claude-flow@alpha", "mcp-server"]
                }
              }
            }

          direct_prompt: |
            ## ğŸ› è‡ªå‹•ãƒã‚°ä¿®æ­£ã‚¿ã‚¹ã‚¯

            ### ã‚¹ãƒ†ãƒƒãƒ—1: å•é¡Œã®ç‰¹å®š
            1. Issueã®å†…å®¹ã‚’åˆ†æ
            2. Serenaã®find_symbolã§é–¢é€£ã‚³ãƒ¼ãƒ‰ã‚’ç‰¹å®š
            3. ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ãŒã‚ã‚Œã°è§£æ

            ### ã‚¹ãƒ†ãƒƒãƒ—2: æ ¹æœ¬åŸå› åˆ†æ
            1. Claude-Flowã®neural_analyzeã§å•é¡Œãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’èªè­˜
            2. find_referencing_symbolsã§å½±éŸ¿ç¯„å›²ã‚’ç¢ºèª
            3. é¡ä¼¼ã®éå»ã®ä¿®æ­£ã‚’memory_queryã§æ¤œç´¢

            ### ã‚¹ãƒ†ãƒƒãƒ—3: ä¿®æ­£å®Ÿè£…
            1. replace_symbol_bodyã§å•é¡Œç®‡æ‰€ã‚’ä¿®æ­£
            2. ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ /æ›´æ–°
            3. execute_shell_commandã§ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

            ### ã‚¹ãƒ†ãƒƒãƒ—4: æ¤œè¨¼
            1. ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆãŒé€šã‚‹ã“ã¨ã‚’ç¢ºèª
            2. å½±éŸ¿ç¯„å›²ã®å†ãƒ†ã‚¹ãƒˆ
            3. ä¿®æ­£å†…å®¹ã®è¦ç´„ã‚’ã‚³ãƒ¡ãƒ³ãƒˆ
