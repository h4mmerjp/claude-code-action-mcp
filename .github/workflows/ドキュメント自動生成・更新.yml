name: ğŸ“š AIãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç®¡ç†
on:
  push:
    branches: [main]
    paths:
      - "src/**/*.ts"
      - "src/**/*.js"
      - "src/**/*.py"
  workflow_dispatch:
    inputs:
      scope:
        description: "Documentation scope"
        required: false
        default: "all"

jobs:
  auto-documentation:
    runs-on: ubuntu-latest

    steps:
      - name: ğŸ“¥ Checkout
        uses: actions/checkout@v4

      - name: ğŸ“ Generate/Update Documentation
        uses: anthropics/claude-code-action@beta
        with:
          anthropic_api_key: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
          base_branch: "main"
          branch_prefix: "docs/"

          mcp_config: |
            {
              "mcpServers": {
                "serena": {
                  "command": "uvx",
                  "args": [
                    "--from", "git+https://github.com/oraios/serena",
                    "serena-mcp-server",
                    "--mode", "one-shot",
                    "--mode", "planning"
                  ]
                },
                "claude-flow": {
                  "command": "npx",
                  "args": [
                    "claude-flow@alpha", "mcp-server",
                    "--strategy", "documentation"
                  ]
                }
              }
            }

          direct_prompt: |
            ## ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆè‡ªå‹•ç”Ÿæˆã‚¿ã‚¹ã‚¯

            ### 1. ã‚³ãƒ¼ãƒ‰åˆ†æ
            - Serenaã®get_symbols_overviewã§å…¨ä½“æ§‹é€ ã‚’æŠŠæ¡
            - æ–°è¦/å¤‰æ›´ã•ã‚ŒãŸAPIã‚’ç‰¹å®š
            - å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’æŠ½å‡º

            ### 2. ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ
            - APIä»•æ§˜æ›¸ã®ä½œæˆ/æ›´æ–°
            - ä½¿ç”¨ä¾‹ã®ç”Ÿæˆ
            - å‹å®šç¾©ã®æ–‡æ›¸åŒ–
            - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®èª¬æ˜

            ### 3. æ—¢å­˜ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã®çµ±åˆ
            - README.mdã®æ›´æ–°
            - CHANGELOG.mdã¸ã®è¿½è¨˜
            - API.mdã®æ›´æ–°

            ### 4. å“è³ªãƒã‚§ãƒƒã‚¯
            - ãƒªãƒ³ã‚¯ã®æœ‰åŠ¹æ€§ç¢ºèª
            - ã‚³ãƒ¼ãƒ‰ä¾‹ã®å‹•ä½œç¢ºèª
            - ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯

            ã™ã¹ã¦ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æœ€æ–°ã®çŠ¶æ…‹ã«ä¿ã£ã¦ãã ã•ã„ã€‚
